Description: cdk-monorepo-backend-pipeline
Resources:
    cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8:
        Type: AWS::KMS::Key
        Properties:
            KeyPolicy:
                Statement:
                    - Action:
                          - kms:Create*
                          - kms:Describe*
                          - kms:Enable*
                          - kms:List*
                          - kms:Put*
                          - kms:Update*
                          - kms:Revoke*
                          - kms:Disable*
                          - kms:Get*
                          - kms:Delete*
                          - kms:ScheduleKeyDeletion
                          - kms:CancelKeyDeletion
                          - kms:GenerateDataKey
                          - kms:TagResource
                          - kms:UntagResource
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::Join:
                                  - ''
                                  - - 'arn:'
                                    - Ref: AWS::Partition
                                    - :iam::694710432912:root
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelinePipelineRole0309F669
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleEE60908C
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleEE60908C
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelineUpdatePipelineSelfMutationRole18352EE4
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelineUpdatePipelineSelfMutationRole18352EE4
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                                  - Arn
                      Resource: '*'
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::Join:
                                  - ''
                                  - - 'arn:'
                                    - Ref: AWS::Partition
                                    - :iam::694710432912:role/cdk-hnb659fds-deploy-role-694710432912-ap-southeast-1
                      Resource: '*'
                Version: '2012-10-17'
        UpdateReplacePolicy: Delete
        DeletionPolicy: Delete
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/ArtifactsBucketEncryptionKey/Resource
    cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyAliasE82DCE36:
        Type: AWS::KMS::Alias
        Properties:
            AliasName: alias/codepipeline-cdkmonorepobackendpipelinepipeline17467f37
            TargetKeyId:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                    - Arn
        UpdateReplacePolicy: Delete
        DeletionPolicy: Delete
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/ArtifactsBucketEncryptionKeyAlias/Resource
    cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E:
        Type: AWS::S3::Bucket
        Properties:
            BucketEncryption:
                ServerSideEncryptionConfiguration:
                    - ServerSideEncryptionByDefault:
                          KMSMasterKeyID:
                              Fn::GetAtt:
                                  - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                                  - Arn
                          SSEAlgorithm: aws:kms
            PublicAccessBlockConfiguration:
                BlockPublicAcls: true
                BlockPublicPolicy: true
                IgnorePublicAcls: true
                RestrictPublicBuckets: true
        UpdateReplacePolicy: Retain
        DeletionPolicy: Retain
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/ArtifactsBucket/Resource
    cdkmonorepobackendpipelinePipelineRole0309F669:
        Type: AWS::IAM::Role
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Principal:
                          Service: codepipeline.amazonaws.com
                Version: '2012-10-17'
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Role/Resource
    cdkmonorepobackendpipelinePipelineRoleDefaultPolicy83ADB250:
        Type: AWS::IAM::Policy
        Properties:
            PolicyDocument:
                Statement:
                    - Action:
                          - s3:GetObject*
                          - s3:GetBucket*
                          - s3:List*
                          - s3:DeleteObject*
                          - s3:PutObject*
                          - s3:Abort*
                      Effect: Allow
                      Resource:
                          - Fn::GetAtt:
                                - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                - Arn
                          - Fn::Join:
                                - ''
                                - - Fn::GetAtt:
                                        - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                        - Arn
                                  - /*
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                              - Arn
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineBuildSynthCodePipelineActionRole19A625F3
                              - Arn
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineUpdatePipelineSelfMutateCodePipelineActionRole93773810
                              - Arn
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                              - Arn
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Resource:
                          Fn::Join:
                              - ''
                              - - 'arn:'
                                - Ref: AWS::Partition
                                - :iam::694710432912:role/cdk-hnb659fds-deploy-role-694710432912-ap-southeast-1
                Version: '2012-10-17'
            PolicyName: cdkmonorepobackendpipelinePipelineRoleDefaultPolicy83ADB250
            Roles:
                - Ref: cdkmonorepobackendpipelinePipelineRole0309F669
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Role/DefaultPolicy/Resource
    cdkmonorepobackendpipelinePipelineCD020AB7:
        Type: AWS::CodePipeline::Pipeline
        Properties:
            RoleArn:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineRole0309F669
                    - Arn
            Stages:
                - Actions:
                      - ActionTypeId:
                            Category: Source
                            Owner: ThirdParty
                            Provider: GitHub
                            Version: '1'
                        Configuration:
                            Owner: ziggy6792
                            Repo: cdk-monorepo-example
                            Branch: feature/add-pipeline-2
                            OAuthToken: '{{resolve:secretsmanager:GITHUB_OATH_TOKEN:SecretString:GITHUB_OATH_TOKEN::}}'
                            PollForSourceChanges: true
                        Name: GitHub
                        OutputArtifacts:
                            - Name: Artifact_Source_GitHub
                        RunOrder: 1
                  Name: Source
                - Actions:
                      - ActionTypeId:
                            Category: Build
                            Owner: AWS
                            Provider: CodeBuild
                            Version: '1'
                        Configuration:
                            ProjectName:
                                Ref: cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectBC77B5E6
                            EnvironmentVariables: '[{"name":"_PROJECT_CONFIG_HASH","type":"PLAINTEXT","value":"a25d4d5614ffea15e0464d43ff5f7eaaff82d0f0ea516cbd0f1c30bcfbc86129"}]'
                        InputArtifacts:
                            - Name: Artifact_Source_GitHub
                        Name: Synth
                        OutputArtifacts:
                            - Name: Artifact_Build_Synth
                        RoleArn:
                            Fn::GetAtt:
                                - cdkmonorepobackendpipelinePipelineBuildSynthCodePipelineActionRole19A625F3
                                - Arn
                        RunOrder: 1
                  Name: Build
                - Actions:
                      - ActionTypeId:
                            Category: Build
                            Owner: AWS
                            Provider: CodeBuild
                            Version: '1'
                        Configuration:
                            ProjectName:
                                Ref: cdkmonorepobackendpipelineUpdatePipelineSelfMutation15150BF6
                        InputArtifacts:
                            - Name: Artifact_Build_Synth
                        Name: SelfMutate
                        RoleArn:
                            Fn::GetAtt:
                                - cdkmonorepobackendpipelinePipelineUpdatePipelineSelfMutateCodePipelineActionRole93773810
                                - Arn
                        RunOrder: 1
                  Name: UpdatePipeline
                - Actions:
                      - ActionTypeId:
                            Category: Build
                            Owner: AWS
                            Provider: CodeBuild
                            Version: '1'
                        Configuration:
                            ProjectName:
                                Ref: cdkmonorepobackendpipelineAssetsFileAsset1AB447F09
                        InputArtifacts:
                            - Name: Artifact_Build_Synth
                        Name: FileAsset1
                        RoleArn:
                            Fn::GetAtt:
                                - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                                - Arn
                        RunOrder: 1
                      - ActionTypeId:
                            Category: Build
                            Owner: AWS
                            Provider: CodeBuild
                            Version: '1'
                        Configuration:
                            ProjectName:
                                Ref: cdkmonorepobackendpipelineAssetsFileAsset2B39CA1CE
                        InputArtifacts:
                            - Name: Artifact_Build_Synth
                        Name: FileAsset2
                        RoleArn:
                            Fn::GetAtt:
                                - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                                - Arn
                        RunOrder: 1
                  Name: Assets
                - Actions:
                      - ActionTypeId:
                            Category: Deploy
                            Owner: AWS
                            Provider: CloudFormation
                            Version: '1'
                        Configuration:
                            StackName: cdk-monorepo-backend-staging-deployment
                            Capabilities: CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND
                            RoleArn:
                                Fn::Join:
                                    - ''
                                    - - 'arn:'
                                      - Ref: AWS::Partition
                                      - :iam::694710432912:role/cdk-hnb659fds-cfn-exec-role-694710432912-ap-southeast-1
                            ActionMode: CHANGE_SET_REPLACE
                            ChangeSetName: PipelineChange
                            TemplatePath: Artifact_Build_Synth::assembly-cdk-monorepo-backend-pipeline-cdk-monorepo-backend-staging/cdkmonorepobackendpipelinecdkmonorepobackendstagingdeploymentB952C8A6.template.json
                        InputArtifacts:
                            - Name: Artifact_Build_Synth
                        Name: deployment.Prepare
                        RoleArn:
                            Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :iam::694710432912:role/cdk-hnb659fds-deploy-role-694710432912-ap-southeast-1
                        RunOrder: 1
                      - ActionTypeId:
                            Category: Deploy
                            Owner: AWS
                            Provider: CloudFormation
                            Version: '1'
                        Configuration:
                            StackName: cdk-monorepo-backend-staging-deployment
                            ActionMode: CHANGE_SET_EXECUTE
                            ChangeSetName: PipelineChange
                        Name: deployment.Deploy
                        RoleArn:
                            Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :iam::694710432912:role/cdk-hnb659fds-deploy-role-694710432912-ap-southeast-1
                        RunOrder: 2
                  Name: cdk-monorepo-backend-staging
                - Actions:
                      - ActionTypeId:
                            Category: Deploy
                            Owner: AWS
                            Provider: CloudFormation
                            Version: '1'
                        Configuration:
                            StackName: cdk-monorepo-backend-prod-deployment
                            Capabilities: CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND
                            RoleArn:
                                Fn::Join:
                                    - ''
                                    - - 'arn:'
                                      - Ref: AWS::Partition
                                      - :iam::694710432912:role/cdk-hnb659fds-cfn-exec-role-694710432912-ap-southeast-1
                            ActionMode: CHANGE_SET_REPLACE
                            ChangeSetName: PipelineChange
                            TemplatePath: Artifact_Build_Synth::assembly-cdk-monorepo-backend-pipeline-cdk-monorepo-backend-prod/cdkmonorepobackendpipelinecdkmonorepobackendproddeployment280F754A.template.json
                        InputArtifacts:
                            - Name: Artifact_Build_Synth
                        Name: deployment.Prepare
                        RoleArn:
                            Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :iam::694710432912:role/cdk-hnb659fds-deploy-role-694710432912-ap-southeast-1
                        RunOrder: 1
                      - ActionTypeId:
                            Category: Deploy
                            Owner: AWS
                            Provider: CloudFormation
                            Version: '1'
                        Configuration:
                            StackName: cdk-monorepo-backend-prod-deployment
                            ActionMode: CHANGE_SET_EXECUTE
                            ChangeSetName: PipelineChange
                        Name: deployment.Deploy
                        RoleArn:
                            Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :iam::694710432912:role/cdk-hnb659fds-deploy-role-694710432912-ap-southeast-1
                        RunOrder: 2
                  Name: cdk-monorepo-backend-prod
            ArtifactStore:
                EncryptionKey:
                    Id:
                        Fn::GetAtt:
                            - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                            - Arn
                    Type: KMS
                Location:
                    Ref: cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                Type: S3
            Name: cdk-monorepo-backend-pipeline
            RestartExecutionOnUpdate: true
        DependsOn:
            - cdkmonorepobackendpipelinePipelineRoleDefaultPolicy83ADB250
            - cdkmonorepobackendpipelinePipelineRole0309F669
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Resource
    cdkmonorepobackendpipelinePipelineBuildSynthCodePipelineActionRole19A625F3:
        Type: AWS::IAM::Role
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::Join:
                                  - ''
                                  - - 'arn:'
                                    - Ref: AWS::Partition
                                    - :iam::694710432912:root
                Version: '2012-10-17'
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Build/Synth/CodePipelineActionRole/Resource
    cdkmonorepobackendpipelinePipelineBuildSynthCodePipelineActionRoleDefaultPolicyCBE7DFBA:
        Type: AWS::IAM::Policy
        Properties:
            PolicyDocument:
                Statement:
                    - Action:
                          - codebuild:BatchGetBuilds
                          - codebuild:StartBuild
                          - codebuild:StopBuild
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectBC77B5E6
                              - Arn
                Version: '2012-10-17'
            PolicyName: cdkmonorepobackendpipelinePipelineBuildSynthCodePipelineActionRoleDefaultPolicyCBE7DFBA
            Roles:
                - Ref: cdkmonorepobackendpipelinePipelineBuildSynthCodePipelineActionRole19A625F3
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Build/Synth/CodePipelineActionRole/DefaultPolicy/Resource
    cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleEE60908C:
        Type: AWS::IAM::Role
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Principal:
                          Service: codebuild.amazonaws.com
                Version: '2012-10-17'
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Build/Synth/CdkBuildProject/Role/Resource
    cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleDefaultPolicy8155CFAC:
        Type: AWS::IAM::Policy
        Properties:
            PolicyDocument:
                Statement:
                    - Action:
                          - logs:CreateLogGroup
                          - logs:CreateLogStream
                          - logs:PutLogEvents
                      Effect: Allow
                      Resource:
                          - Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :logs:ap-southeast-1:694710432912:log-group:/aws/codebuild/
                                  - Ref: cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectBC77B5E6
                          - Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :logs:ap-southeast-1:694710432912:log-group:/aws/codebuild/
                                  - Ref: cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectBC77B5E6
                                  - :*
                    - Action:
                          - codebuild:CreateReportGroup
                          - codebuild:CreateReport
                          - codebuild:UpdateReport
                          - codebuild:BatchPutTestCases
                          - codebuild:BatchPutCodeCoverages
                      Effect: Allow
                      Resource:
                          Fn::Join:
                              - ''
                              - - 'arn:'
                                - Ref: AWS::Partition
                                - :codebuild:ap-southeast-1:694710432912:report-group/
                                - Ref: cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectBC77B5E6
                                - -*
                    - Action:
                          - s3:GetObject*
                          - s3:GetBucket*
                          - s3:List*
                          - s3:DeleteObject*
                          - s3:PutObject*
                          - s3:Abort*
                      Effect: Allow
                      Resource:
                          - Fn::GetAtt:
                                - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                - Arn
                          - Fn::Join:
                                - ''
                                - - Fn::GetAtt:
                                        - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                        - Arn
                                  - /*
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                              - Arn
                    - Action:
                          - kms:Decrypt
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                              - Arn
                Version: '2012-10-17'
            PolicyName: cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleDefaultPolicy8155CFAC
            Roles:
                - Ref: cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleEE60908C
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Build/Synth/CdkBuildProject/Role/DefaultPolicy/Resource
    cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectBC77B5E6:
        Type: AWS::CodeBuild::Project
        Properties:
            Artifacts:
                Type: CODEPIPELINE
            Environment:
                ComputeType: BUILD_GENERAL1_SMALL
                Image: aws/codebuild/standard:4.0
                ImagePullCredentialsType: CODEBUILD
                PrivilegedMode: false
                Type: LINUX_CONTAINER
            ServiceRole:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineBuildSynthCdkBuildProjectRoleEE60908C
                    - Arn
            Source:
                BuildSpec: >-
                    {
                      "version": "0.2",
                      "phases": {
                        "pre_build": {
                          "commands": [
                            "yarn install --frozen-lockfile"
                          ]
                        },
                        "build": {
                          "commands": [
                            "yarn run build",
                            "yarn cdk:synth"
                          ]
                        }
                      },
                      "artifacts": {
                        "base-directory": "cdk.out",
                        "files": "**/*"
                      }
                    }
                Type: CODEPIPELINE
            EncryptionKey:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                    - Arn
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/Build/Synth/CdkBuildProject/Resource
    cdkmonorepobackendpipelinePipelineUpdatePipelineSelfMutateCodePipelineActionRole93773810:
        Type: AWS::IAM::Role
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Principal:
                          AWS:
                              Fn::Join:
                                  - ''
                                  - - 'arn:'
                                    - Ref: AWS::Partition
                                    - :iam::694710432912:root
                Version: '2012-10-17'
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/UpdatePipeline/SelfMutate/CodePipelineActionRole/Resource
    cdkmonorepobackendpipelinePipelineUpdatePipelineSelfMutateCodePipelineActionRoleDefaultPolicy1590B0D4:
        Type: AWS::IAM::Policy
        Properties:
            PolicyDocument:
                Statement:
                    - Action:
                          - codebuild:BatchGetBuilds
                          - codebuild:StartBuild
                          - codebuild:StopBuild
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelineUpdatePipelineSelfMutation15150BF6
                              - Arn
                Version: '2012-10-17'
            PolicyName: cdkmonorepobackendpipelinePipelineUpdatePipelineSelfMutateCodePipelineActionRoleDefaultPolicy1590B0D4
            Roles:
                - Ref: cdkmonorepobackendpipelinePipelineUpdatePipelineSelfMutateCodePipelineActionRole93773810
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Pipeline/UpdatePipeline/SelfMutate/CodePipelineActionRole/DefaultPolicy/Resource
    cdkmonorepobackendpipelineUpdatePipelineSelfMutationRole18352EE4:
        Type: AWS::IAM::Role
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Principal:
                          Service: codebuild.amazonaws.com
                Version: '2012-10-17'
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/UpdatePipeline/SelfMutation/Role/Resource
    cdkmonorepobackendpipelineUpdatePipelineSelfMutationRoleDefaultPolicyD1E37029:
        Type: AWS::IAM::Policy
        Properties:
            PolicyDocument:
                Statement:
                    - Action:
                          - logs:CreateLogGroup
                          - logs:CreateLogStream
                          - logs:PutLogEvents
                      Effect: Allow
                      Resource:
                          - Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :logs:ap-southeast-1:694710432912:log-group:/aws/codebuild/
                                  - Ref: cdkmonorepobackendpipelineUpdatePipelineSelfMutation15150BF6
                          - Fn::Join:
                                - ''
                                - - 'arn:'
                                  - Ref: AWS::Partition
                                  - :logs:ap-southeast-1:694710432912:log-group:/aws/codebuild/
                                  - Ref: cdkmonorepobackendpipelineUpdatePipelineSelfMutation15150BF6
                                  - :*
                    - Action:
                          - codebuild:CreateReportGroup
                          - codebuild:CreateReport
                          - codebuild:UpdateReport
                          - codebuild:BatchPutTestCases
                          - codebuild:BatchPutCodeCoverages
                      Effect: Allow
                      Resource:
                          Fn::Join:
                              - ''
                              - - 'arn:'
                                - Ref: AWS::Partition
                                - :codebuild:ap-southeast-1:694710432912:report-group/
                                - Ref: cdkmonorepobackendpipelineUpdatePipelineSelfMutation15150BF6
                                - -*
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Resource:
                          - arn:*:iam::*:role/*-deploy-role-*
                          - arn:*:iam::*:role/*-publishing-role-*
                    - Action: cloudformation:DescribeStacks
                      Effect: Allow
                      Resource: '*'
                    - Action: s3:ListBucket
                      Effect: Allow
                      Resource: '*'
                    - Action:
                          - s3:GetObject*
                          - s3:GetBucket*
                          - s3:List*
                      Effect: Allow
                      Resource:
                          - Fn::GetAtt:
                                - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                - Arn
                          - Fn::Join:
                                - ''
                                - - Fn::GetAtt:
                                        - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                        - Arn
                                  - /*
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                              - Arn
                    - Action:
                          - kms:Decrypt
                          - kms:Encrypt
                          - kms:ReEncrypt*
                          - kms:GenerateDataKey*
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                              - Arn
                Version: '2012-10-17'
            PolicyName: cdkmonorepobackendpipelineUpdatePipelineSelfMutationRoleDefaultPolicyD1E37029
            Roles:
                - Ref: cdkmonorepobackendpipelineUpdatePipelineSelfMutationRole18352EE4
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/UpdatePipeline/SelfMutation/Role/DefaultPolicy/Resource
    cdkmonorepobackendpipelineUpdatePipelineSelfMutation15150BF6:
        Type: AWS::CodeBuild::Project
        Properties:
            Artifacts:
                Type: CODEPIPELINE
            Environment:
                ComputeType: BUILD_GENERAL1_SMALL
                Image: aws/codebuild/standard:4.0
                ImagePullCredentialsType: CODEBUILD
                PrivilegedMode: false
                Type: LINUX_CONTAINER
            ServiceRole:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelineUpdatePipelineSelfMutationRole18352EE4
                    - Arn
            Source:
                BuildSpec: >-
                    {
                      "version": "0.2",
                      "phases": {
                        "install": {
                          "commands": "npm install -g aws-cdk"
                        },
                        "build": {
                          "commands": [
                            "cdk -a . deploy cdk-monorepo-backend-pipeline --require-approval=never --verbose"
                          ]
                        }
                      }
                    }
                Type: CODEPIPELINE
            EncryptionKey:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                    - Arn
            Name: cdk-monorepo-backend-pipeline-selfupdate
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/UpdatePipeline/SelfMutation/Resource
    cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6:
        Type: AWS::IAM::Role
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Principal:
                          Service: codebuild.amazonaws.com
                          AWS:
                              Fn::Join:
                                  - ''
                                  - - 'arn:'
                                    - Ref: AWS::Partition
                                    - :iam::694710432912:root
                Version: '2012-10-17'
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Assets/FileRole/Resource
    cdkmonorepobackendpipelineAssetsFileRoleDefaultPolicy2C1A0981:
        Type: AWS::IAM::Policy
        Properties:
            PolicyDocument:
                Statement:
                    - Action:
                          - logs:CreateLogGroup
                          - logs:CreateLogStream
                          - logs:PutLogEvents
                      Effect: Allow
                      Resource:
                          Fn::Join:
                              - ''
                              - - 'arn:'
                                - Ref: AWS::Partition
                                - :logs:ap-southeast-1:694710432912:log-group:/aws/codebuild/*
                    - Action:
                          - codebuild:CreateReportGroup
                          - codebuild:CreateReport
                          - codebuild:UpdateReport
                          - codebuild:BatchPutTestCases
                          - codebuild:BatchPutCodeCoverages
                      Effect: Allow
                      Resource:
                          Fn::Join:
                              - ''
                              - - 'arn:'
                                - Ref: AWS::Partition
                                - :codebuild:ap-southeast-1:694710432912:report-group/*
                    - Action:
                          - codebuild:BatchGetBuilds
                          - codebuild:StartBuild
                          - codebuild:StopBuild
                      Effect: Allow
                      Resource: '*'
                    - Action: sts:AssumeRole
                      Effect: Allow
                      Resource: arn:*:iam::*:role/*-file-publishing-role-*
                    - Action:
                          - s3:GetObject*
                          - s3:GetBucket*
                          - s3:List*
                      Effect: Allow
                      Resource:
                          - Fn::GetAtt:
                                - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                - Arn
                          - Fn::Join:
                                - ''
                                - - Fn::GetAtt:
                                        - cdkmonorepobackendpipelinePipelineArtifactsBucket17FCB36E
                                        - Arn
                                  - /*
                    - Action:
                          - kms:Decrypt
                          - kms:DescribeKey
                      Effect: Allow
                      Resource:
                          Fn::GetAtt:
                              - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                              - Arn
                Version: '2012-10-17'
            PolicyName: cdkmonorepobackendpipelineAssetsFileRoleDefaultPolicy2C1A0981
            Roles:
                - Ref: cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Assets/FileRole/DefaultPolicy/Resource
    cdkmonorepobackendpipelineAssetsFileAsset1AB447F09:
        Type: AWS::CodeBuild::Project
        Properties:
            Artifacts:
                Type: CODEPIPELINE
            Environment:
                ComputeType: BUILD_GENERAL1_SMALL
                Image: aws/codebuild/standard:4.0
                ImagePullCredentialsType: CODEBUILD
                PrivilegedMode: false
                Type: LINUX_CONTAINER
            ServiceRole:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                    - Arn
            Source:
                BuildSpec: >-
                    {
                      "version": "0.2",
                      "phases": {
                        "install": {
                          "commands": "npm install -g cdk-assets"
                        },
                        "build": {
                          "commands": [
                            "cdk-assets --path \"assembly-cdk-monorepo-backend-pipeline-cdk-monorepo-backend-staging/cdkmonorepobackendpipelinecdkmonorepobackendstagingdeploymentB952C8A6.assets.json\" --verbose publish \"ba86d91f0f9de3b922faa52b527ff783e991c5b59b2f8a6ebf6f221422bce6f0:694710432912-ap-southeast-1\"",
                            "cdk-assets --path \"assembly-cdk-monorepo-backend-pipeline-cdk-monorepo-backend-prod/cdkmonorepobackendpipelinecdkmonorepobackendproddeployment280F754A.assets.json\" --verbose publish \"ba86d91f0f9de3b922faa52b527ff783e991c5b59b2f8a6ebf6f221422bce6f0:694710432912-ap-southeast-1\""
                          ]
                        }
                      }
                    }
                Type: CODEPIPELINE
            EncryptionKey:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                    - Arn
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Assets/FileAsset1/Default/Resource
    cdkmonorepobackendpipelineAssetsFileAsset2B39CA1CE:
        Type: AWS::CodeBuild::Project
        Properties:
            Artifacts:
                Type: CODEPIPELINE
            Environment:
                ComputeType: BUILD_GENERAL1_SMALL
                Image: aws/codebuild/standard:4.0
                ImagePullCredentialsType: CODEBUILD
                PrivilegedMode: false
                Type: LINUX_CONTAINER
            ServiceRole:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelineAssetsFileRoleB61CA7D6
                    - Arn
            Source:
                BuildSpec: >-
                    {
                      "version": "0.2",
                      "phases": {
                        "install": {
                          "commands": "npm install -g cdk-assets"
                        },
                        "build": {
                          "commands": [
                            "cdk-assets --path \"assembly-cdk-monorepo-backend-pipeline-cdk-monorepo-backend-staging/cdkmonorepobackendpipelinecdkmonorepobackendstagingdeploymentB952C8A6.assets.json\" --verbose publish \"b3393ee714d8a14bea207df286b1b1a20b97a97b31edd70fb8c6333c9469558a:694710432912-ap-southeast-1\"",
                            "cdk-assets --path \"assembly-cdk-monorepo-backend-pipeline-cdk-monorepo-backend-prod/cdkmonorepobackendpipelinecdkmonorepobackendproddeployment280F754A.assets.json\" --verbose publish \"b3393ee714d8a14bea207df286b1b1a20b97a97b31edd70fb8c6333c9469558a:694710432912-ap-southeast-1\""
                          ]
                        }
                      }
                    }
                Type: CODEPIPELINE
            EncryptionKey:
                Fn::GetAtt:
                    - cdkmonorepobackendpipelinePipelineArtifactsBucketEncryptionKeyF745E0D8
                    - Arn
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/cdk-monorepo-backend-pipeline/Assets/FileAsset2/Default/Resource
    CDKMetadata:
        Type: AWS::CDK::Metadata
        Properties:
            Modules: aws-cdk=1.78.0,@aws-cdk/assets=1.75.0,@aws-cdk/aws-apigateway=1.75.0,@aws-cdk/aws-applicationautoscaling=1.75.0,@aws-cdk/aws-autoscaling=1.75.0,@aws-cdk/aws-autoscaling-common=1.75.0,@aws-cdk/aws-autoscaling-hooktargets=1.75.0,@aws-cdk/aws-certificatemanager=1.75.0,@aws-cdk/aws-cloudformation=1.75.0,@aws-cdk/aws-cloudfront=1.75.0,@aws-cdk/aws-cloudfront-origins=1.75.0,@aws-cdk/aws-cloudwatch=1.75.0,@aws-cdk/aws-codebuild=1.75.0,@aws-cdk/aws-codeguruprofiler=1.75.0,@aws-cdk/aws-codepipeline=1.75.0,@aws-cdk/aws-codepipeline-actions=1.75.0,@aws-cdk/aws-cognito=1.75.0,@aws-cdk/aws-dynamodb=1.75.0,@aws-cdk/aws-ec2=1.75.0,@aws-cdk/aws-ecr=1.75.0,@aws-cdk/aws-ecr-assets=1.75.0,@aws-cdk/aws-ecs=1.75.0,@aws-cdk/aws-elasticloadbalancingv2=1.75.0,@aws-cdk/aws-elasticsearch=1.75.0,@aws-cdk/aws-events=1.75.0,@aws-cdk/aws-events-targets=1.75.0,@aws-cdk/aws-iam=1.75.0,@aws-cdk/aws-kinesis=1.75.0,@aws-cdk/aws-kinesisanalytics=1.75.0,@aws-cdk/aws-kms=1.75.0,@aws-cdk/aws-lambda=1.75.0,@aws-cdk/aws-lambda-event-sources=1.75.0,@aws-cdk/aws-logs=1.75.0,@aws-cdk/aws-s3=1.75.0,@aws-cdk/aws-s3-assets=1.75.0,@aws-cdk/aws-s3-notifications=1.75.0,@aws-cdk/aws-sagemaker=1.75.0,@aws-cdk/aws-sam=1.75.0,@aws-cdk/aws-secretsmanager=1.75.0,@aws-cdk/aws-servicediscovery=1.75.0,@aws-cdk/aws-sns=1.75.0,@aws-cdk/aws-sns-subscriptions=1.75.0,@aws-cdk/aws-sqs=1.75.0,@aws-cdk/aws-ssm=1.75.0,@aws-cdk/aws-stepfunctions=1.75.0,@aws-cdk/cloud-assembly-schema=1.75.0,@aws-cdk/core=1.75.0,@aws-cdk/custom-resources=1.75.0,@aws-cdk/cx-api=1.75.0,@aws-cdk/pipelines=1.75.0,@aws-cdk/region-info=1.75.0,@aws-solutions-constructs/core=1.75.0,jsii-runtime=node.js/v14.14.0
        Metadata:
            aws:cdk:path: cdk-monorepo-backend-pipeline/CDKMetadata/Default
Parameters:
    BootstrapVersion:
        Type: AWS::SSM::Parameter::Value<String>
        Default: /cdk-bootstrap/hnb659fds/version
        Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store.
Rules:
    CheckBootstrapVersion:
        Assertions:
            - Assert:
                  Fn::Not:
                      - Fn::Contains:
                            - - '1'
                              - '2'
                              - '3'
                            - Ref: BootstrapVersion
              AssertDescription: CDK bootstrap stack version 4 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.
